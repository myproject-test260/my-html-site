<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒã‚±ãƒ¢ãƒ³æƒ…å ±æ¤œç´¢</title>
<style>
/* -------------------------------------- */
/* 1. CSS ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ (å¤‰æ›´ãªã—) */
/* -------------------------------------- */
:root {
  --background-color: #f5f5f5;
  --text-color: #333;
  --card-background: #ffffff;
  --table-border-color: #e0e0e0;
  --table-background-color: #fafafa;
  --table-row-hover-background: #f5f5f5;
  --error-color: #ff4d4d;
  --national-dex-number-color: #0066cc;
  --button-background: #4a90e2;
  --button-hover: #357abd;
  --shadow: 0 2px 8px rgba(0,0,0,0.1);
  --border-radius: 8px; 
}

@media (prefers-color-scheme: dark) {
  :root {
    --background-color: #121212;
    --text-color: #e0e0e0;
    --card-background: #1e1e1e;
    --table-border-color: #333;
    --table-background-color: #252525;
    --table-row-hover-background: #2a2a2a;
    --national-dex-number-color: #ffaa00;
    --button-background: #2d5f8d;
    --button-hover: #4a90e2;
    --shadow: 0 2px 8px rgba(0,0,0,0.3);
  }
}

* {
  box-sizing: border-box;
}

body {
  background-color: var(--background-color);
  color: var(--text-color);
  padding: 20px;
  font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
  line-height: 1.6;
}

.container {
  max-width: 1000px;
  margin: 0 auto;
}

h1 {
  text-align: center;
  margin-bottom: 30px;
  font-size: 2rem;
}

.search-section {
  background: var(--card-background);
  padding: 20px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  margin-bottom: 20px;
}

.search-controls {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  flex-wrap: wrap;
  align-items: center;
}

.search-controls label {
  font-weight: 600;
}

.search-input-group {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  flex: 1;
  min-width: 250px;
}

.navigation-buttons {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: center;
}

input[type="number"],
input[type="text"] {
  padding: 10px 15px;
  font-size: 1rem;
  border: 2px solid var(--table-border-color);
  border-radius: 8px;
  background: var(--card-background);
  color: var(--text-color);
  flex: 1;
  min-width: 120px;
}

button {
  padding: 10px 20px;
  font-size: 1rem;
  background-color: var(--button-background);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 500;
}

button:hover {
  background-color: var(--button-hover);
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

button:active {
  transform: translateY(0);
}

.navigation-buttons button {
  padding: 8px 16px;
  min-width: 50px;
}

.pokemon-name-header {
  background: var(--card-background);
  padding: 20px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  margin-bottom: 20px;
  text-align: center;
}

.pokemon-name-header h2 {
  margin: 0;
  font-size: 2.5rem;
  color: var(--national-dex-number-color);
}

.pokemon-name-header .generation {
  color: #888;
  font-size: 1rem;
  margin-top: 5px;
}

.content-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 20px;
  margin-bottom: 20px;
}

@media (min-width: 768px) {
  .content-grid {
    grid-template-columns: 1fr 1fr;
  }
}

.card {
  background: var(--card-background);
  padding: 20px;
  border-radius: 12px;
  box-shadow: var(--shadow);
}

.card h3 {
  margin-top: 0;
  margin-bottom: 15px;
  font-size: 1.3rem;
  border-bottom: 2px solid var(--table-border-color);
  padding-bottom: 10px;
}

.image-container {
  display: flex;
  justify-content: center;
  gap: 20px;
  flex-wrap: wrap;
  padding: 10px;
}

.image-frame {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.image-frame img {
  width: 150px;
  height: 150px;
  object-fit: contain;
  border-radius: 8px;
  background: var(--table-background-color);
  padding: 10px;
}

.image-label {
  font-size: 0.85rem;
  color: #888;
  font-weight: 500;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid var(--table-border-color);
}

th {
  background-color: var(--table-background-color);
  font-weight: 600;
  width: 40%;
}

tr:hover {
  background-color: var(--table-row-hover-background);
}

tr:last-child th,
tr:last-child td {
  border-bottom: none;
}

.error-message {
  color: var(--error-color);
  text-align: center;
  padding: 20px;
  background: var(--card-background);
  border-radius: 12px;
  box-shadow: var(--shadow);
}

.hidden-ability {
  color: #ff6b6b;
  font-weight: 600;
}

.hidden {
  display: none;
}

.pokemon-dex-number a {
  color: var(--national-dex-number-color);
  text-decoration: none;
  font-weight: 600;
}

.pokemon-dex-number a:hover {
  text-decoration: underline;
}

.pokemon-dex-number a:visited {
  color: #999999;
}

@media (prefers-color-scheme: dark) {
  .pokemon-dex-number a:visited {
    color: #aaaaaa;
  }
}

.loading-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 20px;
  background: var(--card-background);
  border-radius: 12px;
  box-shadow: var(--shadow);
}

.loading-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid rgba(74, 144, 226, 0.3);
  border-radius: 50%;
  border-top-color: var(--button-background);
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.search-hint {
  font-size: 0.85rem;
  color: #888;
  margin-top: 5px;
}

.tabs {
  background: var(--card-background);
  border-radius: 12px;
  box-shadow: var(--shadow);
  overflow: hidden;
}

.tab-buttons {
  display: flex;
  border-bottom: 2px solid var(--table-border-color);
  background: var(--table-background-color);
}

.tab-button {
  flex: 1;
  padding: 15px 20px;
  background: transparent;
  color: var(--text-color);
  border: none;
  border-radius: 0;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  transition: all 0.3s;
  position: relative;
  box-shadow: none;
}

.tab-button:hover {
  background-color: var(--table-row-hover-background);
  transform: none;
}

.tab-button.active {
  background-color: var(--card-background);
  color: var(--national-dex-number-color);
}

.tab-button.active::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--national-dex-number-color);
}

.tab-content {
  padding: 20px;
}

.tab-panel {
  display: none;
}

.tab-panel.active {
  display: block;
}

/* é€²åŒ–ãƒ„ãƒªãƒ¼è¡¨ç¤ºç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
#pokemonEvolution ul {
    list-style: none;
    padding-left: 20px;
    border-left: 2px dashed #ccc;
    margin: 5px 0;
}
#pokemonEvolution li {
    position: relative;
    padding-left: 20px;
}
#pokemonEvolution li:before {
    content: 'â””';
    position: absolute;
    left: 0;
    top: 0;
    font-size: 1.2rem;
    color: #999;
}


@media (max-width: 600px) {
  h1 {
    font-size: 1.5rem;
  }
  
  .pokemon-name-header h2 {
    font-size: 1.8rem;
  }
  
  .search-controls {
    flex-direction: column;
    align-items: stretch;
  }
  
  .search-input-group {
    flex-direction: column;
  }
  
  input[type="number"],
  input[type="text"] {
    width: 100%;
  }
  
  .image-frame img {
    width: 120px;
    height: 120px;
  }
}
</style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” ãƒã‚±ãƒ¢ãƒ³æƒ…å ±æ¤œç´¢ v202511014</h1>
    
    <div class="search-section">
      <div class="search-controls">
        <div class="search-input-group">
          <input type="text" id="pokemonName" placeholder="ä¾‹: ãƒ”ã‚«ãƒãƒ¥ã‚¦ã€Pikachu">
          <input type="number" id="pokemonId" min="1" placeholder="ä¾‹: 25">
        </div>
        <button onclick="searchPokemon()">ğŸ” æ¤œç´¢</button>
        <button onclick="clearAll()" style="background-color: #e74c3c;">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
      </div>
      <div class="search-hint">
        ğŸ’¡ åå‰ã®ä¸€éƒ¨ã§ã‚‚æ¤œç´¢ã§ãã¾ã™(ä¾‹: ãƒ”ã‚«ã€ãƒªã‚¶ã€chu ãªã©)
      </div>
    </div>
    
    <div id="loadingMessage" class="hidden">
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <span>èª­ã¿è¾¼ã¿ä¸­...</span>
      </div>
    </div>
    
    <div id="pokemonInfo"></div>
    
    <div id="pokemonNameHeader" class="pokemon-name-header hidden"></div>
    
    <div id="pokemonTabs" class="tabs hidden">
      <div class="tab-buttons">
        <button class="tab-button active" onclick="switchTab('basic')">ğŸ“Š åŸºæœ¬æƒ…å ±</button>
        <button class="tab-button" onclick="switchTab('stats')">âš¡ ç¨®æ—å€¤</button>
        <button class="tab-button" onclick="switchTab('evolution')">ğŸ”„ é€²åŒ–/ãƒ•ã‚©ãƒ¼ãƒ </button>
        <button class="tab-button" onclick="switchTab('image')">ğŸ–¼ï¸ ç”»åƒ</button>
        <button class="tab-button" onclick="switchTab('dex')">ğŸ“– å›³é‘‘æƒ…å ±</button>
      </div>
      
      <div class="tab-content">
        <div id="basicTab" class="tab-panel active">
          <table id="pokemonBasicInfo"></table>
        </div>
        
        <div id="statsTab" class="tab-panel">
          <div id="pokemonStats"></div>
        </div>
        
        <div id="evolutionTab" class="tab-panel">
          <div id="pokemonEvolution"></div>
        </div>
        
        <div id="imageTab" class="tab-panel">
          <div id="pokemonImage"></div>
        </div>
        
        <div id="dexTab" class="tab-panel">
          <table id="pokemonDexInfo"></table>
        </div>
      </div>
    </div>
  </div>

<script>
// --------------------------------------
// 2. JavaScript ãƒ­ã‚¸ãƒƒã‚¯ 
// --------------------------------------

const cache = {};
let nameToIdCache = null;

const clearAll = () => {
  const nameInput = document.getElementById('pokemonName');
  const idInput = document.getElementById('pokemonId');
  nameInput.value = '';
  idInput.value = '';
  document.getElementById('pokemonInfo').innerHTML = '';
  document.getElementById('pokemonNameHeader').classList.add('hidden');
  document.getElementById('pokemonTabs').classList.add('hidden');
};

const switchTab = (tabName) => {
  document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
  
  const buttons = document.querySelectorAll('.tab-button');
  if (tabName === 'basic') buttons[0].classList.add('active');
  else if (tabName === 'stats') buttons[1].classList.add('active');
  else if (tabName === 'evolution') buttons[2].classList.add('active');
  else if (tabName === 'image') buttons[3].classList.add('active');
  else if (tabName === 'dex') buttons[4].classList.add('active');
  
  document.getElementById(tabName + 'Tab').classList.add('active');
};

document.addEventListener('DOMContentLoaded', () => {
  const nameInput = document.getElementById('pokemonName');
  const idInput = document.getElementById('pokemonId');

  const handleEnter = async function(event) {
    if (event.key === 'Enter') {
      event.preventDefault();
      searchPokemon();
    }
  };

  nameInput.addEventListener('keypress', handleEnter);
  idInput.addEventListener('keypress', handleEnter);
  
  // åˆæœŸè¡¨ç¤º
  //fetchPokemonDetails('25'); // ãƒ”ã‚«ãƒãƒ¥ã‚¦
});

const generationTranslations = {
  "generation-i": "ç¬¬1ä¸–ä»£", "generation-ii": "ç¬¬2ä¸–ä»£", "generation-iii": "ç¬¬3ä¸–ä»£",
  "generation-iv": "ç¬¬4ä¸–ä»£", "generation-v": "ç¬¬5ä¸–ä»£", "generation-vi": "ç¬¬6ä¸–ä»£",
  "generation-vii": "ç¬¬7ä¸–ä»£", "generation-viii": "ç¬¬8ä¸–ä»£", "generation-ix": "ç¬¬9ä¸–ä»£",
};

const pokedexNameTranslations = {
  "national": "å…¨å›½å›³é‘‘",
  "kanto": "ã‚«ãƒ³ãƒˆãƒ¼å›³é‘‘",
  "original-johto": "ã‚¸ãƒ§ã‚¦ãƒˆå›³é‘‘(ã‚ªãƒªã‚¸ãƒŠãƒ«)",
  "hoenn": "ãƒ›ã‚¦ã‚¨ãƒ³å›³é‘‘",
  "original-sinnoh": "ã‚·ãƒ³ã‚ªã‚¦å›³é‘‘(ã‚ªãƒªã‚¸ãƒŠãƒ«)",
  "extended-sinnoh": "ã‚·ãƒ³ã‚ªã‚¦å›³é‘‘(ãƒ—ãƒ©ãƒãƒŠæ‹¡å¼µ)",
  "updated-johto": "ã‚¸ãƒ§ã‚¦ãƒˆå›³é‘‘(æ”¹è¨‚ç‰ˆ)",
  "original-unova": "ã‚¤ãƒƒã‚·ãƒ¥å›³é‘‘(BW)",
  "updated-unova": "ã‚¤ãƒƒã‚·ãƒ¥å›³é‘‘(BW2)",
  "conquest-gallery": "ãƒã‚±ãƒ¢ãƒ³+ãƒãƒ–ãƒŠã‚¬ã®é‡æœ› å›³é‘‘",
  "kalos-central": "ã‚«ãƒ­ã‚¹å›³é‘‘ ã‚»ãƒ³ãƒˆãƒ©ãƒ«",
  "kalos-coastal": "ã‚«ãƒ­ã‚¹å›³é‘‘ ã‚³ãƒ¼ã‚¹ãƒˆ",
  "kalos-mountain": "ã‚«ãƒ­ã‚¹å›³é‘‘ ãƒã‚¦ãƒ³ãƒ†ãƒ³",
  "updated-hoenn": "ãƒ›ã‚¦ã‚¨ãƒ³å›³é‘‘(ORAS)",
  "original-alola": "ã‚¢ãƒ­ãƒ¼ãƒ©å›³é‘‘(SM)",
  "original-melemele": "ãƒ¡ãƒ¬ãƒ¡ãƒ¬å›³é‘‘(SM)",
  "original-akala": "ã‚¢ãƒ¼ã‚«ãƒ©å›³é‘‘(SM)",
  "original-ulaula": "ã‚¦ãƒ©ã‚¦ãƒ©å›³é‘‘(SM)",
  "original-poni": "ãƒãƒ‹å›³é‘‘(SM)",
  "updated-alola": "ã‚¢ãƒ­ãƒ¼ãƒ©å›³é‘‘(USUM)",
  "updated-melemele": "ãƒ¡ãƒ¬ãƒ¡ãƒ¬å›³é‘‘(USUM)",
  "updated-akala": "ã‚¢ãƒ¼ã‚«ãƒ©å›³é‘‘(USUM)",
  "updated-ulaula": "ã‚¦ãƒ©ã‚¦ãƒ©å›³é‘‘(USUM)",
  "updated-poni": "ãƒãƒ‹å›³é‘‘(USUM)",
  "letsgo-kanto": "ã‚«ãƒ³ãƒˆãƒ¼å›³é‘‘(Let's Go)",
  "galar": "ã‚¬ãƒ©ãƒ«å›³é‘‘",
  "isle-of-armor": "ãƒ¨ãƒ­ã‚¤å³¶å›³é‘‘",
  "crown-tundra": "ã‚«ãƒ³ãƒ ãƒªé›ªåŸå›³é‘‘",
  "hisui": "ãƒ’ã‚¹ã‚¤å›³é‘‘",
  "paldea": "ãƒ‘ãƒ«ãƒ‡ã‚¢å›³é‘‘",
  "kitakami": "ã‚­ã‚¿ã‚«ãƒŸå›³é‘‘",
  "blueberry": "ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼å›³é‘‘",
  "lumiose-city": "ãƒŸã‚¢ãƒ¬ã‚·ãƒ†ã‚£å›³é‘‘"
};

// åå‰ã‹ã‚‰IDã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ­ãƒ¼ãƒ‰å‡¦ç†
const loadNameToIdMapping = async () => {
  if (nameToIdCache) return nameToIdCache;
  
  try {
    // å…¨ãƒã‚±ãƒ¢ãƒ³ãƒªã‚¹ãƒˆã‚’ä¸€åº¦ã«å–å¾—
    const response = await fetch('https://pokeapi.co/api/v2/pokemon-species?limit=2000');
    if (!response.ok) throw new Error("ãƒã‚±ãƒ¢ãƒ³ãƒªã‚¹ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
    const data = await response.json();
    
    nameToIdCache = {};
    
    // å…¨ãƒã‚±ãƒ¢ãƒ³ã®åå‰ã¨IDã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ (æ™‚é–“ãŒã‹ã‹ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚æ³¨æ„)
    await Promise.all(data.results.map(async (pokemon) => {
      try {
        const speciesResponse = await fetch(pokemon.url);
        const speciesData = await speciesResponse.json();
        const id = speciesData.id;
        
        // æ—¥æœ¬èªåã€è‹±èªåã€ã‚¹ãƒ©ãƒƒã‚°ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°
        const japaneseName = speciesData.names.find(n => n.language.name === "ja")?.name;
        if (japaneseName) nameToIdCache[japaneseName.toLowerCase()] = id;
        
        const englishName = speciesData.names.find(n => n.language.name === "en")?.name;
        if (englishName) nameToIdCache[englishName.toLowerCase()] = id;
        
        nameToIdCache[speciesData.name.toLowerCase()] = id;
      } catch (error) {
        // å€‹åˆ¥ã®ãƒã‚±ãƒ¢ãƒ³ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–ã—ã¦ç¶šè¡Œ
      }
    }));
    
    return nameToIdCache;
  } catch (error) {
    console.error("åå‰ãƒãƒƒãƒ”ãƒ³ã‚°ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:", error);
    return {};
  }
};

const searchPokemon = async () => {
  const nameInput = document.getElementById('pokemonName').value.trim();
  const idInput = document.getElementById('pokemonId').value.trim();
  
  if (idInput) {
    fetchPokemonDetails(idInput);
  } else if (nameInput) {
    clearAll();
    document.getElementById('loadingMessage').classList.remove('hidden');
    
    const mapping = await loadNameToIdMapping();
    document.getElementById('loadingMessage').classList.add('hidden');
    
    const searchKey = nameInput.toLowerCase();
    
    let pokemonId = mapping[searchKey];
    
    if (!pokemonId) {
      // éƒ¨åˆ†ä¸€è‡´æ¤œç´¢
      const matches = Object.keys(mapping).filter(name => name.includes(searchKey));
      
      if (matches.length === 1) {
        pokemonId = mapping[matches[0]];
      } else if (matches.length > 1) {
        // å€™è£œãƒªã‚¹ãƒˆè¡¨ç¤º
        matches.sort();
        
        const suggestions = matches.slice(0, 10).map(name => {
          const id = mapping[name];
          const formattedId = id.toString().padStart(4, '0');
          return `<li style="cursor:pointer; padding:5px; margin:5px 0; background:var(--table-background-color); border-radius:4px;" onclick="document.getElementById('pokemonName').value=''; document.getElementById('pokemonId').value='${id}'; fetchPokemonDetails('${id}');">${name} (No.${formattedId})</li>`;
        }).join('');
        
        document.getElementById('pokemonInfo').innerHTML = 
          `<div class="error-message">
            <p>ã€Œ${nameInput}ã€ã«ä¸€è‡´ã™ã‚‹å€™è£œãŒ${matches.length}ä»¶è¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚</p>
            <p style="font-size:0.9rem; margin-top:10px;">ä»¥ä¸‹ã‹ã‚‰é¸æŠã—ã¦ãã ã•ã„:</p>
            <ul style="list-style:none; padding:0; text-align:left; max-width:400px; margin:10px auto;">${suggestions}</ul>
            ${matches.length > 10 ? '<p style="font-size:0.85rem; color:#888;">(æœ€åˆã®10ä»¶ã‚’è¡¨ç¤º)</p>' : ''}
          </div>`;
        return;
      }
    }
    
    if (pokemonId) {
      document.getElementById('pokemonId').value = pokemonId;
      fetchPokemonDetails(pokemonId.toString());
    } else {
      document.getElementById('pokemonInfo').innerHTML = 
        `<p class="error-message">ã€Œ${nameInput}ã€ã¨ã„ã†åå‰ã®ãƒã‚±ãƒ¢ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚<br>æ—¥æœ¬èªåã¾ãŸã¯è‹±èªåã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>`;
    }
  } else {
    document.getElementById('pokemonInfo').innerHTML = 
      `<p class="error-message">ãƒã‚±ãƒ¢ãƒ³åã¾ãŸã¯å›³é‘‘ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>`;
  }
};

const fetchColorJapaneseName = async (colorUrl) => {
  const response = await fetch(colorUrl);
  if (!response.ok) throw new Error("è‰²æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
  const colorData = await response.json();
  const japaneseName = colorData.names.find(name => name.language.name === "ja")?.name ?? "ä¸æ˜";
  return japaneseName; 
};

const fetchTypeJapaneseNames = async (types) => {
  const typeNames = await Promise.all(types.map(async typeInfo => {
    const response = await fetch(typeInfo.type.url);
    if (!response.ok) throw new Error("ã‚¿ã‚¤ãƒ—ã®æ—¥æœ¬èªåã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
    const data = await response.json();
    const japaneseName = data.names.find(n => n.language.name === "ja")?.name || typeInfo.type.name;
    return japaneseName;
  }));
  return typeNames.join(', ');
};

const fetchAbilityJapaneseNames = async (abilities) => {
  return Promise.all(
    abilities.map(async (ability) => {
      const url = ability.ability.url;
      const res = await fetch(url);
      if (!res.ok) throw new Error("ç‰¹æ€§åã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
      const data = await res.json();
      let japaneseName = data.names.find(n => n.language.name === "ja")?.name;
      if (ability.is_hidden) {
        japaneseName = `<span class="hidden-ability">${japaneseName} (å¤¢)</span>`;
      } else {
        japaneseName = `<span>${japaneseName}</span>`;
      }
      return japaneseName || `<span>${ability.ability.name}</span>`;
    })
  );
};

const fetchEggGroupJapaneseNames = async (eggGroups) => {
  const eggGroupNames = await Promise.all(
    eggGroups.map(async group => {
      const url = group.url;
      const res = await fetch(url);
      if (!res.ok) throw new Error("ã‚¿ãƒã‚´ã‚°ãƒ«ãƒ¼ãƒ—åã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
      const data = await res.json();
      // ja-Hrkt (æ—¥æœ¬èªã²ã‚‰ãŒãªã‚«ã‚¿ã‚«ãƒŠ) ã‚’å„ªå…ˆçš„ã«ä½¿ç”¨
      return data.names.find(n => n.language.name === "ja-Hrkt")?.name ?? group.name;
    })
  );
  return eggGroupNames.join(", ");
};

// =========================================================================
// é€²åŒ–å…ˆã®é‡è¤‡ã‚’æ’é™¤ã—ã€æ¡ä»¶ã‚’çµ±åˆã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
// =========================================================================

const deduplicateAndMergeEvolutions = (evolvesToArray) => {
    const mergedMap = new Map();
    
    evolvesToArray.forEach(evo => {
        const id = evo.id;
        
        if (!mergedMap.has(id)) {
            // æ–°ã—ã„ã‚¨ãƒ³ãƒˆãƒªã®å ´åˆã€ãã®ã¾ã¾è¿½åŠ (evolutionDetailsã¯ã‚³ãƒ”ãƒ¼)
            mergedMap.set(id, { ...evo, evolutionDetails: [...evo.evolutionDetails] });
        } else {
            // æ—¢å­˜ã®ã‚¨ãƒ³ãƒˆãƒªã®å ´åˆã€æ–°ã—ã„evolutionDetailsã‚’æ—¢å­˜ã®ãƒªã‚¹ãƒˆã«çµåˆ(ãƒãƒ¼ã‚¸)
            const existingEvo = mergedMap.get(id);
            existingEvo.evolutionDetails.push(...evo.evolutionDetails);
        }
    });
    
    return Array.from(mergedMap.values());
};

// =========================================================================
// é€²åŒ–ãƒã‚§ãƒ¼ãƒ³å–å¾—ãƒ»ãƒ•ã‚©ãƒ¼ãƒ (Varieties)è‡ªå‹•åˆ¤å®šé–¢æ•°
// =========================================================================

const fetchEvolutionChain = async (evolutionChainUrl, currentSpeciesId) => {
  try {
    const evolutionResponse = await fetch(evolutionChainUrl);
    if (!evolutionResponse.ok) {
        console.warn("é€²åŒ–ãƒã‚§ãƒ¼ãƒ³ã®URLãŒç„¡åŠ¹ã§ã™ã€‚");
        return { tree: null, flattened: [], varieties: await fetchVarieties(currentSpeciesId) };
    }
    const data = await evolutionResponse.json();
    
    // ãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±ã®å–å¾— (Varieties: ãƒ¡ã‚¬ã€ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã€ãƒ­ãƒˆãƒ ã€ãƒ“ãƒ“ãƒ¨ãƒ³ãªã©å…¨ã¦ã‚’æ‰±ã†)
    const fetchVarieties = async (speciesId) => {
      try {
        const speciesResponse = await fetch(`https://pokeapi.co/api/v2/pokemon-species/${speciesId}/`);
        const speciesData = await speciesResponse.json();
        const varieties = [];
        
        for (const variety of speciesData.varieties) {
          // â˜…â˜…â˜… ä¿®æ­£: is_default ã®å ´åˆã¯ varieties ãŒ1ã¤ã®ã‚±ãƒ¼ã‚¹ã®ã¿å‡¦ç† â˜…â˜…â˜…
          if (variety.is_default) {
              if (speciesData.varieties.length === 1) {
                  // varietiesãŒ1ã¤ã®ã¿(ãƒ“ãƒ“ãƒ¨ãƒ³ã€ã‚¢ãƒ³ãƒãƒ¼ãƒ³ã€ã‚¢ãƒ«ã‚»ã‚¦ã‚¹ãªã©)ã®å ´åˆã€formsã‚’ãƒã‚§ãƒƒã‚¯
                  const pokemonResponse = await fetch(variety.pokemon.url);
                  const pokemonData = await pokemonResponse.json();
                  
                  if (pokemonData.forms.length > 1) {
                      // formsãŒè¤‡æ•°ã‚ã‚‹å ´åˆ(ãƒ“ãƒ“ãƒ¨ãƒ³ã€ã‚¢ãƒ³ãƒãƒ¼ãƒ³ã€ã‚¢ãƒ«ã‚»ã‚¦ã‚¹)ã€formsã‚’å…¨ã¦ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ä½¿ç”¨
                      for (const form of pokemonData.forms) {
                          const formResponse = await fetch(form.url);
                          const formData = await formResponse.json();
                          const formJpName = formData.form_names.find(n => n.language.name === "ja")?.name;
                          
                          const formId = formData.id.toString();
                          const formSlug = form.name;
                          
                          // åŸºæœ¬ãƒ•ã‚©ãƒ¼ãƒ ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆ-normalãªã©ï¼‰
                          if (formSlug.includes('-normal') || formSlug === pokemonData.name) {
                              continue;
                          }
                          
                          varieties.push({
                            name: formJpName || form.name,
                            id: formSlug,
                            displayId: formId,
                            isMega: false,
                            isGmax: false,
                            isRegional: false
                          });
                      }
                      // formsã‚’ä½¿ã£ãŸã‚‰ varieties ã®å‡¦ç†ã¯ã“ã“ã§çµ‚äº†
                      return varieties.sort((a, b) => a.name.localeCompare(b.name)); 
                  }
              }
              // varieties ãŒè¤‡æ•°ã‚ã‚‹å ´åˆã€is_default ã¯ã‚¹ã‚­ãƒƒãƒ—
              continue;
          }
          
          // is_default ã§ãªã„ variety ã‚’å‡¦ç†
          try {
            const pokemonResponse = await fetch(variety.pokemon.url);
            const pokemonData = await pokemonResponse.json();
            const pokemonId = pokemonData.id.toString();
            const nameSlug = variety.pokemon.name;
            
            let formName = '';
            
            // ãƒ•ã‚©ãƒ¼ãƒ åã‚’å–å¾— (å„ªå…ˆåº¦: æ—¥æœ¬èªãƒ•ã‚©ãƒ¼ãƒ å > è‹±èªãƒ•ã‚©ãƒ¼ãƒ å > ã‚¹ãƒ©ãƒƒã‚°å)
            if (pokemonData.forms && pokemonData.forms.length > 0) {
              const formResponse = await fetch(pokemonData.forms[0].url);
              const formData = await formResponse.json();
              const japaneseFormName = formData.form_names.find(n => n.language.name === "ja")?.name;
              const englishFormName = formData.form_names.find(n => n.language.name === "en")?.name;
              
              formName = japaneseFormName || englishFormName || nameSlug;
            }
            
            // ç‰¹æ®Šãªãƒ•ã‚©ãƒ¼ãƒ åãŒãªã„å ´åˆã¯ã€ã‚¹ãƒ©ãƒƒã‚°ã‹ã‚‰æ¨æ¸¬ã—ã¦æ•´å½¢
            if (!formName || formName === nameSlug) {
                if (nameSlug.includes('mega')) formName = nameSlug.replace(speciesData.name + '-', '').replace(/-/g, ' ') + ' (ãƒ¡ã‚¬)';
                else if (nameSlug.includes('gmax')) formName = nameSlug.replace(speciesData.name + '-', '').replace(/-/g, ' ') + ' (ã‚­ãƒ§ãƒ€ã‚¤)';
                else if (nameSlug.includes('alola')) formName = 'ã‚¢ãƒ­ãƒ¼ãƒ©åœ°æ–¹ã®ã™ãŒãŸ';
                else if (nameSlug.includes('galar')) formName = 'ã‚¬ãƒ©ãƒ«åœ°æ–¹ã®ã™ãŒãŸ';
                else if (nameSlug.includes('hisui')) formName = 'ãƒ’ã‚¹ã‚¤åœ°æ–¹ã®ã™ãŒãŸ';
                else if (nameSlug.includes('paldea')) formName = 'ãƒ‘ãƒ«ãƒ‡ã‚¢åœ°æ–¹ã®ã™ãŒãŸ';
                else {
                    // ãã®ä»–ã€ãƒ­ãƒˆãƒ ã‚„ã‚±ãƒ«ãƒ‡ã‚£ã‚ªã®ã‚ˆã†ãªé€šå¸¸ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³
                    formName = nameSlug.replace(speciesData.name + '-', '').replace(/-/g, ' ');
                    formName = formName.split(' ').map(s => s.charAt(0).toUpperCase() + s.slice(1)).join(' ');
                }
            }
            
            // ãƒ•ã‚©ãƒ¼ãƒ åã®æ•´å½¢
            formName = formName.replace(speciesData.name, '').trim();
            
            varieties.push({
              name: formName || nameSlug,
              id: pokemonId,
              isMega: nameSlug.includes('mega'),
              isGmax: nameSlug.includes('gmax'),
              isRegional: nameSlug.includes('alola') || nameSlug.includes('galar') || nameSlug.includes('hisui') || nameSlug.includes('paldea')
            });
          } catch (error) {
            console.error(`ãƒ•ã‚©ãƒ¼ãƒ  ${variety.pokemon.name} ã®å–å¾—ã«å¤±æ•—:`, error);
            // ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸãƒ•ã‚©ãƒ¼ãƒ ã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ç¶šè¡Œ
          }
        }
        
        return varieties.sort((a, b) => {
            // IDãŒæ•°å€¤ã§ãªã„å ´åˆã¯æ–‡å­—åˆ—æ¯”è¼ƒã‚’ç¶šã‘ã‚‹
            if (isNaN(a.id) || isNaN(b.id)) {
                 return a.name.localeCompare(b.name);
            }
            return parseInt(a.id) - parseInt(b.id);
        });
      } catch (error) {
        console.error("ãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±ã®å–å¾—ã«å¤±æ•—:", error);
        return [];
      }
    };

    
    const processChain = async (evoData, depth = 0) => {
      const speciesUrl = evoData.species.url;
      const speciesId = speciesUrl.split('/').filter(x => x).pop();
      
      const speciesResponse = await fetch(speciesUrl);
      const speciesData = await speciesResponse.json();
      const japaneseName = speciesData.names.find(n => n.language.name === "ja")?.name || evoData.species.name;
      
      const evolutionInfo = {
        name: japaneseName,
        id: speciesId,
        depth: depth,
        evolvesTo: [],
        evolutionDetails: evoData.evolution_details || []
      };
      
      if (evoData.evolves_to && evoData.evolves_to.length > 0) {
        for (const nextEvo of evoData.evolves_to) {
          const childEvo = await processChain(nextEvo, depth + 1);
          evolutionInfo.evolvesTo.push(childEvo);
        }
      }
      
      return evolutionInfo;
    };
    
    const tree = await processChain(data.chain);
    
    // 3. ãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±ã®å–å¾—
    const currentVarieties = await fetchVarieties(currentSpeciesId);
    
    return {
      tree: tree,
      varieties: currentVarieties
    };
  } catch (error) {
    console.error("é€²åŒ–æƒ…å ±ã®å–å¾—ã«å¤±æ•—:", error);
    return null;
  }
};

// =========================================================================
// ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºé–¢æ•° (ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ãƒ©ãƒƒã‚°å¯¾å¿œ)
// =========================================================================

const fetchPokemonDetails = async (pokemonId) => {
  const pokemonIdTrimmed = pokemonId.trim();
  
  if (!pokemonIdTrimmed) {
     clearAll();
     document.getElementById('pokemonInfo').innerHTML = `<p class="error-message">æœ‰åŠ¹ãªå…¨å›½å›³é‘‘No.ã¾ãŸã¯ãƒ•ã‚©ãƒ¼ãƒ åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>`;
     return;
  }

  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã¯å…ƒã®ID(æ•°å€¤)ã¾ãŸã¯ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ãƒ©ãƒƒã‚°ã‚’ä½¿ç”¨
  const cacheKey = pokemonIdTrimmed;
  if (cache[cacheKey]) {
    const cachedData = cache[cacheKey];
    createInfoTable(cachedData.speciesData, cachedData.pokemonData, cachedData.japaneseName, cachedData.imageUrl, cachedData.shinyImageUrl, cachedData.colorJapaneseName, cachedData.typeJapaneseNames, cachedData.weight, cachedData.abilitiesJapaneseNames, cachedData.height, cachedData.eggGroupJapaneseNames, cachedData.generationJapaneseName, cachedData.evolutionChain);
    document.getElementById('pokemonNameHeader').classList.remove('hidden');
    document.getElementById('pokemonTabs').classList.remove('hidden');
    return;
  }

  clearAll();
  document.getElementById('loadingMessage').classList.remove('hidden');

  let pokemonData;
  let speciesData;
  let formNameForDisplay = null; // ãƒ•ã‚©ãƒ¼ãƒ å(ã‚¹ãƒ©ãƒƒã‚°)ã‚’ä¿æŒ

  try {
    
    // IDãŒæ•°å€¤ã§ãªã„å ´åˆã¯ã€ãƒã‚¤ãƒ•ãƒ³ã®æœ‰ç„¡ã«é–¢ã‚ã‚‰ãšã‚¹ãƒ©ãƒƒã‚°ã¨ã—ã¦æ‰±ã†
    if (isNaN(pokemonIdTrimmed)) {
        formNameForDisplay = pokemonIdTrimmed;
        
        // 1. pokemon-form/slug ã‹ã‚‰æƒ…å ±ã‚’å–å¾—
        const formResponse = await fetch(`https://pokeapi.co/api/v2/pokemon-form/${formNameForDisplay}`);
        if (!formResponse.ok) throw new Error("Form not found");
        const formData = await formResponse.json();
        
        // 2. ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æœ¬ä½“ã®ãƒã‚±ãƒ¢ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾— (stats, typesãªã©ã‚’å–å¾—ã™ã‚‹ãŸã‚)
        const pokemonResponse = await fetch(formData.pokemon.url);
        if (!pokemonResponse.ok) throw new Error("Pokemon not found via form");
        pokemonData = await pokemonResponse.json();
        
        // 3. speciesDataã‚‚å–å¾—
        const speciesResponse = await fetch(pokemonData.species.url);
        if (!speciesResponse.ok) throw new Error("Species not found");
        speciesData = await speciesResponse.json();

        // ç”»åƒURLã‚’ãƒ•ã‚©ãƒ¼ãƒ ã®Spritesã«ä¸Šæ›¸ã
        pokemonData.sprites = formData.sprites;
        // IDã‚’ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ãƒ©ãƒƒã‚°ã«ä¸Šæ›¸ã (è¡¨ç¤ºãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”¨)
        pokemonData.id = formNameForDisplay;

    } else {
        // é€šå¸¸ã®æ•°å€¤IDã§ã®æ¤œç´¢ (ä¾‹: 201, 25)
        try {
            const pokemonResponse = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonIdTrimmed}/`);
            if (!pokemonResponse.ok) throw new Error("Pokemon not found");
            pokemonData = await pokemonResponse.json();
            
            const speciesResponse = await fetch(pokemonData.species.url);
            if (!speciesResponse.ok) throw new Error("Species not found");
            speciesData = await speciesResponse.json();
        } catch (error) {
            throw new Error("æŒ‡å®šã•ã‚ŒãŸIDã®ãƒã‚±ãƒ¢ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
        }
    }

    // ã“ã“ã‹ã‚‰å…ˆã¯ã€é€šå¸¸ã®IDã¾ãŸã¯ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ãƒ©ãƒƒã‚°ã§ã®ãƒ‡ãƒ¼ã‚¿å–å¾—å¾Œã®å…±é€šå‡¦ç†
    
    const [typeJapaneseNames, colorJapaneseName, abilitiesJapaneseNames, eggGroupJapaneseNames] = await Promise.all([
      fetchTypeJapaneseNames(pokemonData.types),
      fetchColorJapaneseName(speciesData.color.url),
      fetchAbilityJapaneseNames(pokemonData.abilities),
      fetchEggGroupJapaneseNames(speciesData.egg_groups)
    ]);
    
    const evolutionChain = await fetchEvolutionChain(speciesData.evolution_chain.url, speciesData.id.toString());

    let japaneseName = speciesData.names.find(n => n.language.name === "ja")?.name ?? pokemonData.name;
    
    // ãƒ•ã‚©ãƒ¼ãƒ åã‚’å–å¾—ã—ã€åŸºæœ¬åã«è¿½åŠ 
    if (formNameForDisplay) {
        // ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ãƒ©ãƒƒã‚°ã§æ¤œç´¢ã—ãŸå ´åˆ
        try {
            const formResponse = await fetch(`https://pokeapi.co/api/v2/pokemon-form/${formNameForDisplay}`);
            const formData = await formResponse.json();
            const japaneseFormName = formData.form_names.find(n => n.language.name === "ja")?.name;
            
            if (japaneseFormName) {
                japaneseName += ` (${japaneseFormName})`;
            } else {
                let nameSlug = formNameForDisplay.replace(speciesData.name, '').replace(/-/g, ' ').trim();
                // ä¾‹å¤–çš„ãªãƒ•ã‚©ãƒ¼ãƒ åã®æ•´å½¢
                if (nameSlug.includes('mega')) nameSlug = 'ãƒ¡ã‚¬ã‚·ãƒ³ã‚«';
                else if (nameSlug.includes('gmax')) nameSlug = 'ã‚­ãƒ§ãƒ€ã‚¤ãƒãƒƒã‚¯ã‚¹';
                else if (nameSlug.includes('alola')) nameSlug = 'ã‚¢ãƒ­ãƒ¼ãƒ©ã®ã™ãŒãŸ';
                else if (nameSlug.includes('galar')) nameSlug = 'ã‚¬ãƒ©ãƒ«ã®ã™ãŒãŸ';
                else if (nameSlug.includes('hisui')) nameSlug = 'ãƒ’ã‚¹ã‚¤ã®ã™ãŒãŸ';
                else if (nameSlug.includes('paldea')) nameSlug = 'ãƒ‘ãƒ«ãƒ‡ã‚¢ã®ã™ãŒãŸ';

                if (nameSlug) japaneseName += ` (${nameSlug.charAt(0).toUpperCase() + nameSlug.slice(1)})`;
            }
        } catch (error) {
            console.error("ãƒ•ã‚©ãƒ¼ãƒ åã®å–å¾—ã«å¤±æ•—:", error);
        }
    } else if (pokemonData.id.toString() !== speciesData.id.toString()) {
        // é€šå¸¸ã®IDæ¤œç´¢ã§ãƒ•ã‚©ãƒ¼ãƒ ã ã£ãŸå ´åˆ(ä¾‹: ãƒ­ãƒˆãƒ ã®åˆ¥å½¢æ…‹)
        try {
            const formResponse = await fetch(pokemonData.forms[0].url);
            const formData = await formResponse.json();
            const japaneseFormName = formData.form_names.find(n => n.language.name === "ja")?.name;
            
            if (japaneseFormName) {
               if (!japaneseName.includes(japaneseFormName)) {
                   japaneseName += ` (${japaneseFormName})`;
               }
            } else {
                const englishFormName = formData.form_names.find(n => n.language.name === "en")?.name;
                const nameSlug = pokemonData.name;
                let formName = englishFormName || nameSlug.replace(/-/g, ' ').replace(speciesData.name, '').trim();

                if (formName.includes('mega')) formName = 'ãƒ¡ã‚¬ã‚·ãƒ³ã‚«';
                else if (formName.includes('gmax')) formName = 'ã‚­ãƒ§ãƒ€ã‚¤ãƒãƒƒã‚¯ã‚¹';
                else if (formName.includes('alola')) formName = 'ã‚¢ãƒ­ãƒ¼ãƒ©ã®ã™ãŒãŸ';
                else if (formName.includes('galar')) formName = 'ã‚¬ãƒ©ãƒ«ã®ã™ãŒãŸ';
                else if (formName.includes('hisui')) formName = 'ãƒ’ã‚¹ã‚¤ã®ã™ãŒãŸ';
                else if (formName.includes('paldea')) formName = 'ãƒ‘ãƒ«ãƒ‡ã‚¢ã®ã™ãŒãŸ';
                
                if(formName) japaneseName += ` (${formName})`;
            }
        } catch (error) {
            console.error("ãƒ•ã‚©ãƒ¼ãƒ åã®å–å¾—ã«å¤±æ•—:", error);
        }
    }
    
    // ç”»åƒURLã‚’spritesã‹ã‚‰å®‰å…¨ã«å–å¾—ã™ã‚‹
    const homeSprites = pokemonData.sprites.other && pokemonData.sprites.other.home;
    const imageUrl = (homeSprites && homeSprites.front_default) || pokemonData.sprites.front_default;
    const shinyImageUrl = (homeSprites && homeSprites.front_shiny) || pokemonData.sprites.front_shiny;
    
    const weight = pokemonData.weight;
    const height = pokemonData.height;
    const generationJapaneseName = generationTranslations[speciesData.generation.name] || speciesData.generation.name;

    const pokemonDataForCache = {
      speciesData, pokemonData, japaneseName, imageUrl, shinyImageUrl, colorJapaneseName, typeJapaneseNames, weight, abilitiesJapaneseNames, height, eggGroupJapaneseNames, generationJapaneseName, evolutionChain
    };
    cache[cacheKey] = pokemonDataForCache;

    createInfoTable(speciesData, pokemonData, japaneseName, imageUrl, shinyImageUrl, colorJapaneseName, typeJapaneseNames, weight, abilitiesJapaneseNames, height, eggGroupJapaneseNames, generationJapaneseName, evolutionChain);

    document.getElementById('pokemonNameHeader').classList.remove('hidden');
    document.getElementById('pokemonTabs').classList.remove('hidden');
    switchTab('basic');
  } catch (error) {
    console.error(error);
    clearAll();
    document.getElementById('pokemonInfo').innerHTML = `<p class="error-message">${error.message}</p>`;
  } finally {
    document.getElementById('loadingMessage').classList.add('hidden');
  }
};

const renderEvolutionCondition = (details) => {
  if (!details || details.length === 0) return '';
  
  const itemTranslations = {
    'fire-stone': 'ã»ã®ãŠã®ã„ã—', 'water-stone': 'ã¿ãšã®ã„ã—', 'thunder-stone': 'ã‹ã¿ãªã‚Šã®ã„ã—',
    'leaf-stone': 'ãƒªãƒ¼ãƒ•ã®ã„ã—', 'moon-stone': 'ã¤ãã®ã„ã—', 'sun-stone': 'ãŸã„ã‚ˆã†ã®ã„ã—',
    'shiny-stone': 'ã²ã‹ã‚Šã®ã„ã—', 'dusk-stone': 'ã‚„ã¿ã®ã„ã—', 'dawn-stone': 'ã‚ã–ã‚ã®ã„ã—',
    'ice-stone': 'ã“ãŠã‚Šã®ã„ã—', 'kings-rock': 'ãŠã†ã˜ã‚ƒã®ã—ã‚‹ã—', 'metal-coat': 'ãƒ¡ã‚¿ãƒ«ã‚³ãƒ¼ãƒˆ',
    'dragon-scale': 'ã‚Šã‚…ã†ã®ã‚¦ãƒ­ã‚³', 'upgrade': 'ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰', 'protector': 'ãƒ—ãƒ­ãƒ†ã‚¯ã‚¿ãƒ¼',
    'electirizer': 'ã‚¨ãƒ¬ã‚­ãƒ–ãƒ¼ã‚¹ã‚¿ãƒ¼', 'magmarizer': 'ãƒã‚°ãƒãƒ–ãƒ¼ã‚¹ã‚¿ãƒ¼', 'dubious-disc': 'ã‚ã‚„ã—ã„ãƒ‘ãƒƒãƒ',
    'reaper-cloth': 'ã‚Œã„ã‹ã„ã®ã¬ã®', 'razor-claw': 'ã™ã‚‹ã©ã„ãƒ„ãƒ¡', 'razor-fang': 'ã™ã‚‹ã©ã„ã‚­ãƒ',
    'oval-stone': 'ã¾ã‚“ã¾ã‚‹ã„ã—', 'prism-scale': 'ãã‚Œã„ãªã‚¦ãƒ­ã‚³', 'deep-sea-tooth': 'ã—ã‚“ã‹ã„ã®ã‚­ãƒ',
    'deep-sea-scale': 'ã—ã‚“ã‹ã„ã®ã‚¦ãƒ­ã‚³', 'sachet': 'ã«ãŠã„ã¶ãã‚', 'whipped-dream': 'ãƒ›ã‚¤ãƒƒãƒ—ãƒãƒƒãƒ—',
    'linking-cord': 'ã¤ãªãŒã‚Šã®ãƒ’ãƒ¢'
  };
  
  const triggerTranslations = {
    'level-up': 'ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—', 'use-item': 'é“å…·ä½¿ç”¨', 'trade': 'é€šä¿¡äº¤æ›', 'shed': 'ã¬ã‘ãŒã‚‰', 'other': 'ç‰¹æ®Š'
  };
  
  const locationTranslations = {
    'eterna-forest': 'ãƒã‚¯ã‚¿ã‚¤ã®ã‚‚ã‚Š', 'pinwheel-forest': 'ãƒ¤ã‚°ãƒ«ãƒã®ã‚‚ã‚Š', 'kalos-route-20': 'ã‚«ãƒ­ã‚¹20ç•ªé“è·¯',
    'sinnoh-route-217': 'ã‚·ãƒ³ã‚ªã‚¦217ç•ªé“è·¯', 'twist-mountain': 'ãƒã‚¸ã‚„ã¾', 'frost-cavern': 'ãƒ•ãƒ­ã‚¹ãƒˆã‚±ã‚¤ãƒ–'
  };
  
  const typeTranslations = {
    'fairy': 'ãƒ•ã‚§ã‚¢ãƒªãƒ¼', 'normal': 'ãƒãƒ¼ãƒãƒ«', 'fighting': 'ã‹ãã¨ã†', 'fire': 'ã»ã®ãŠ',
    'water': 'ã¿ãš', 'grass': 'ãã•', 'electric': 'ã§ã‚“ã', 'psychic': 'ã‚¨ã‚¹ãƒ‘ãƒ¼',
    'ice': 'ã“ãŠã‚Š', 'dragon': 'ãƒ‰ãƒ©ã‚´ãƒ³', 'dark': 'ã‚ã', 'bug': 'ã‚€ã—', 'poison': 'ã©ã',
    'ground': 'ã˜ã‚ã‚“', 'rock': 'ã„ã‚', 'ghost': 'ã‚´ãƒ¼ã‚¹ãƒˆ', 'steel': 'ã¯ãŒã­', 'flying': 'ã²ã“ã†'
  };
  
  const conditions = [];
  details.forEach(detail => {
    const parts = [];
    
    // é“å…·ä½¿ç”¨ã¯ãƒˆãƒªã‚¬ãƒ¼ã‚’çœç•¥
    if (detail.item) {
      const itemName = itemTranslations[detail.item.name] || detail.item.name;
      parts.push(`${itemName}`);
    } else if (detail.trigger) {
      const triggerName = triggerTranslations[detail.trigger.name] || detail.trigger.name;
      parts.push(triggerName);
    }
    
    if (detail.min_level) parts.push(`Lv${detail.min_level}`);
    
    if (detail.min_happiness) parts.push(`ãªã¤ãåº¦${detail.min_happiness}ä»¥ä¸Š`);
    if (detail.min_beauty) parts.push(`ã†ã¤ãã—ã•${detail.min_beauty}ä»¥ä¸Š`);
    if (detail.min_affection) parts.push(`ãªã‹ã‚ˆã—åº¦${detail.min_affection}ä»¥ä¸Š`);
    
    if (detail.time_of_day) {
      const timeMap = { 'day': 'æ˜¼', 'night': 'å¤œ', 'dusk': 'å¤•æ–¹' };
      parts.push(`(${timeMap[detail.time_of_day] || detail.time_of_day})`);
    }
    
    if (detail.location) {
      const locationName = locationTranslations[detail.location.name] || detail.location.name.replace(/-/g, ' ');
      parts.push(`${locationName}`);
    }
    
    if (detail.held_item) {
      const itemName = itemTranslations[detail.held_item.name] || detail.held_item.name;
      parts.push(`æŒã¡ç‰©:${itemName}`);
    }
    
    if (detail.known_move) parts.push(`æŠ€:${detail.known_move.name}`);
    
    if (detail.known_move_type) {
      const typeName = typeTranslations[detail.known_move_type.name] || detail.known_move_type.name;
      parts.push(`${typeName}ã‚¿ã‚¤ãƒ—ã®æŠ€`);
    }
    
    if (detail.party_species) parts.push(`${detail.party_species.name}ãŒæ‰‹æŒã¡`);
    
    if (detail.party_type) {
      const typeName = typeTranslations[detail.party_type.name] || detail.party_type.name;
      parts.push(`${typeName}ã‚¿ã‚¤ãƒ—ãŒæ‰‹æŒã¡`);
    }
    
    if (detail.relative_physical_stats !== null) {
      if (detail.relative_physical_stats === 1) parts.push('æ”»æ’ƒ>é˜²å¾¡');
      else if (detail.relative_physical_stats === -1) parts.push('é˜²å¾¡>æ”»æ’ƒ');
      else if (detail.relative_physical_stats === 0) parts.push('æ”»æ’ƒ=é˜²å¾¡');
    }
    
    if (detail.needs_overworld_rain) parts.push('é›¨å¤©æ™‚');
    if (detail.turn_upside_down) parts.push('æœ¬ä½“ã‚’é€†ã•ã¾');
    if (detail.gender !== null) parts.push(detail.gender === 1 ? 'â™€ã®ã¿' : 'â™‚ã®ã¿');
    
    if (parts.length > 0) {
      conditions.push(parts.join(' + '));
    }
  });
  
  if (conditions.length === 0) return 'ç‰¹æ®Šæ¡ä»¶';
  
  // çµ±åˆã•ã‚ŒãŸæ¡ä»¶ã‚’ " or " ã§çµåˆ
  return conditions.join(' <span style="color:#999; font-weight: bold;">OR</span> ');
};

const renderEvolutionTree = (node, currentPokemonId) => {
    let html = '';
    
    // ç¾åœ¨ã®ãƒã‚±ãƒ¢ãƒ³ã®è¡¨ç¤º
    const isCurrentPokemon = node.id === currentPokemonId.toString();
    const style = isCurrentPokemon 
        ? 'display:inline-block; padding:4px 8px; background:var(--national-dex-number-color); color:white; border-radius:4px; font-weight:bold; transition: all 0.2s;' 
        : 'display:inline-block; padding:4px 8px; background:var(--table-background-color); border:1px solid var(--table-border-color); border-radius:4px; cursor:pointer; color:var(--national-dex-number-color); transition: all 0.2s;';
    const hoverStyle = isCurrentPokemon ? '' : 'onmouseover="this.style.borderColor=\'var(--national-dex-number-color)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.1)\'" onmouseout="this.style.borderColor=\'var(--table-border-color)\'; this.style.boxShadow=\'none\'"';
    const onclick = isCurrentPokemon ? '' : `onclick="document.getElementById('pokemonName').value=''; document.getElementById('pokemonId').value='${node.id}'; fetchPokemonDetails('${node.id}');"`;
    
    html += `<span style="${style}" ${onclick} ${hoverStyle}>${node.name} <small style="color:${isCurrentPokemon ? 'white' : '#888'};">No.${node.id.padStart(4, '0')}</small></span>`;
    
    // é€²åŒ–æ¡ä»¶ã®è¡¨ç¤º
    if (node.evolutionDetails && node.evolutionDetails.length > 0) {
        const consolidatedDetails = deduplicateAndMergeEvolutions([{ id: node.id, evolutionDetails: node.evolutionDetails }])[0].evolutionDetails;
        const conditionText = renderEvolutionCondition(consolidatedDetails);
        if (conditionText) {
            html += `<div style="font-size:0.8rem; color:#666; margin-top:5px; padding:4px 0;"> <span style="font-weight: bold; color: #4a90e2;">æ¡ä»¶:</span> ${conditionText}</div>`;
        }
    }

    // æ¬¡ã®é€²åŒ–å…ˆãŒã‚ã‚‹å ´åˆã€<ul>ã§å†å¸°çš„ã«ãƒªã‚¹ãƒˆåŒ–
    if (node.evolvesTo && node.evolvesTo.length > 0) {
        const nextLevel = deduplicateAndMergeEvolutions(node.evolvesTo.map(e => ({
            name: e.name,
            id: e.id,
            evolutionDetails: e.evolutionDetails
        })));
        
        html += '<ul style="list-style:none; padding-left:25px; margin:5px 0;">';
        nextLevel.forEach(nextEvo => {
             const nextNode = node.evolvesTo.find(e => e.id === nextEvo.id);
             
             const evolvedNodeWithMergedDetails = {
                 ...nextNode,
                 evolutionDetails: nextEvo.evolutionDetails
             };
             
             html += `<li style="margin-top:10px;">${renderEvolutionTree(evolvedNodeWithMergedDetails, currentPokemonId)}</li>`;
        });
        html += '</ul>';
    }
    
    return html;
};

const createInfoTable = (speciesData, pokemonData, japaneseName, imageUrl, shinyImageUrl, colorJapaneseName, typeJapaneseNames, weight, abilities, height, eggGroupJapaneseNames, generationJapaneseName, evolutionChain) => {
  // pokemonData.idãŒæ•°å€¤ã§ãªã„(ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ãƒ©ãƒƒã‚°)å ´åˆãŒã‚ã‚‹ãŸã‚ã€speciesData.idã‚’ä½¿ã†
  const displayId = isNaN(pokemonData.id) ? speciesData.id : pokemonData.id;
  const formattedNationalNumber = displayId.toString().padStart(4, '0');
  
  document.getElementById('pokemonNameHeader').innerHTML = `
    <h2>${japaneseName}</h2>
    <div class="generation">No. ${formattedNationalNumber} | ${generationJapaneseName}</div>
  `;

  // --- åŸºæœ¬æƒ…å ±ã‚¿ãƒ– ---
  const createImageHtml = (url, alt, label) => {
    // ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ãƒ©ãƒƒã‚°ã®å ´åˆã¯IDãŒæ–‡å­—åˆ—ã«ãªã‚‹ãŸã‚ã€URLæ§‹ç¯‰ã‚’èª¿æ•´
    const isFormSlug = isNaN(pokemonData.id);
    let finalUrl = url;
    
    if (!url || url.includes('0.png')) {
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ç”»åƒãŒãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯(Form Slugã®å ´åˆã¯ãã®IDã‚’ä½¿ã£ã¦å†æ§‹ç¯‰)
        if (isFormSlug) {
            // sprites.front_default / front_shinyã‚’ä½¿ã†
            finalUrl = url;
        } else {
            // é€šå¸¸ã®ãƒã‚±ãƒ¢ãƒ³IDã®å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            finalUrl = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${pokemonData.id}.png`;
        }
    }
    
    return `
      <div class="image-frame">
        <img src="${finalUrl}" alt="${alt}" class="pokemon-image" onerror="this.src='https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/0.png'" />
        <div class="image-label">${label}</div>
      </div>`;
  };

  const weightInKilograms = weight / 10;
  const heightInMeters = height / 10;
  const abilitiesFormatted = abilities.join(', ');

  const basicTableBody = document.createElement('tbody');
  const basicInfoPairs = [
    { label: 'è‰²', value: colorJapaneseName },
    { label: 'ã‚¿ã‚¤ãƒ—', value: typeJapaneseNames },
    { label: 'ç‰¹æ€§', value: abilitiesFormatted },
    { label: 'é‡ã•', value: `${weightInKilograms} kg` },
    { label: 'é«˜ã•', value: `${heightInMeters} m` },
    { label: 'ã‚¿ãƒã‚´ã‚°ãƒ«ãƒ¼ãƒ—', value: eggGroupJapaneseNames }
  ];

  basicInfoPairs.forEach(pair => {
    const row = document.createElement('tr');
    const th = document.createElement('th');
    th.textContent = pair.label;
    const td = document.createElement('td');
    td.innerHTML = pair.value;
    row.appendChild(th);
    row.appendChild(td);
    basicTableBody.appendChild(row);
  });

  document.getElementById('pokemonBasicInfo').innerHTML = '';
  document.getElementById('pokemonBasicInfo').appendChild(basicTableBody);

  // --- ç”»åƒã‚¿ãƒ– ---
  document.getElementById('pokemonImage').innerHTML = `
    <div class="image-container">
      ${createImageHtml(imageUrl, japaneseName + 'ã®é€šå¸¸ç”»åƒ', 'é€šå¸¸')}
      ${createImageHtml(shinyImageUrl, japaneseName + 'ã®è‰²é•ã„ç”»åƒ', 'è‰²é•ã„')}
    </div>
  `;

  // --- ç¨®æ—å€¤ã‚¿ãƒ– ---
  createStatsRadarChart(pokemonData.stats);

  // --- é€²åŒ–/ãƒ•ã‚©ãƒ¼ãƒ ã‚¿ãƒ– (æœ€ã‚‚é‡è¦ãªå¤‰æ›´ç®‡æ‰€) ---
  let evolutionHtml = '';
  
  if (evolutionChain && evolutionChain.tree) {
    evolutionHtml += `<div style="padding:10px;">
      <h3 style="margin-top:0;">é€²åŒ–ç³»çµ± (ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°è¡¨ç¤º)</h3>
      <div style="font-size: 1rem; padding: 10px; border: 1px solid var(--table-border-color); border-radius: 8px;">
        ${renderEvolutionTree(evolutionChain.tree, speciesData.id.toString())}
      </div>
    </div>`;
  }
  
  // åˆ¥ãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±ã®è¡¨ç¤º (fetchVarietiesã§å–å¾—ã—ãŸã‚‚ã®ã‚’åˆ©ç”¨)
  if (evolutionChain && evolutionChain.varieties && evolutionChain.varieties.length > 0) {
    const renderVarieties = (varieties) => {
      const megaForms = varieties.filter(v => v.isMega).sort((a,b) => a.name.localeCompare(b.name, 'ja'));
      const gmaxForms = varieties.filter(v => v.isGmax).sort((a,b) => a.name.localeCompare(b.name, 'ja'));
      const regionalForms = varieties.filter(v => v.isRegional).sort((a,b) => a.name.localeCompare(b.name, 'ja'));
      // formsã§å–å¾—ã—ãŸãƒ“ãƒ“ãƒ¨ãƒ³ãªã©ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚„ã€ãƒ­ãƒˆãƒ ãƒ»ã‚±ãƒ«ãƒ‡ã‚£ã‚ªãªã©ã®ç‰¹æ®Šãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³
      const otherForms = varieties.filter(v => !v.isMega && !v.isGmax && !v.isRegional).sort((a,b) => a.name.localeCompare(b.name, 'ja'));
      
      let html = '';
      
      const renderFormBox = (form, color, gradient) => {
        const style = `display:inline-block; min-width:200px; padding:8px 12px; margin:4px; background:${gradient || color}; border:2px solid ${color}; border-radius:8px; cursor:pointer; color:white; transition: all 0.2s; text-align:center; vertical-align:top; font-weight:600; box-shadow: 0 2px 4px rgba(0,0,0,0.1);`;
        const hoverStyle = 'onmouseover="this.style.transform=\'translateY(-2px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.3)\'" onmouseout="this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.1)\'"';
        
        // ãƒ•ã‚©ãƒ¼ãƒ ID(ã‚¹ãƒ©ãƒƒã‚°)ã‚’ãã®ã¾ã¾fetchPokemonDetailsã«æ¸¡ã™
        const onclick = `onclick="document.getElementById('pokemonName').value=''; document.getElementById('pokemonId').value='${form.id}'; fetchPokemonDetails('${form.id}');"`;
        
        const formNameDisplay = form.name.includes(' ') ? form.name.split(' ').map(s => s.charAt(0).toUpperCase() + s.slice(1)).join(' ') : form.name;
        
        // â˜…â˜…â˜… ä¿®æ­£: displayIdãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°å¾“æ¥ã®åˆ¤å®š â˜…â˜…â˜…
        let idDisplay;
        if (form.displayId) {
            idDisplay = form.displayId.padStart(4, '0');
        } else if (isNaN(form.id)) {
            idDisplay = 'Form';
        } else {
            idDisplay = form.id.padStart(4, '0');
        }

        return `<span style="${style}" ${onclick} ${hoverStyle}>${formNameDisplay}<br><small>No.${idDisplay}</small></span>`;
      };
      
      if (megaForms.length > 0) {
        html += '<div style="margin-bottom:12px; text-align:left;"><strong style="color:#ff6b6b;">ãƒ¡ã‚¬ã‚·ãƒ³ã‚«:</strong><br>';
        html += megaForms.map(form => renderFormBox(form, '#764ba2', 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)')).join(' ');
        html += '</div>';
      }
      
      if (gmaxForms.length > 0) {
        html += '<div style="margin-bottom:12px; text-align:left;"><strong style="color:#f5576c;">ã‚­ãƒ§ãƒ€ã‚¤ãƒãƒƒã‚¯ã‚¹:</strong><br>';
        html += gmaxForms.map(form => renderFormBox(form, '#f5576c', 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)')).join(' ');
        html += '</div>';
      }
      
      if (regionalForms.length > 0) {
        html += '<div style="margin-bottom:12px; text-align:left;"><strong style="color:#4a90e2;">ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚©ãƒ¼ãƒ :</strong><br>';
        html += regionalForms.map(form => renderFormBox(form, '#00f2fe', 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)')).join(' ');
        html += '</div>';
      }
      
      if (otherForms.length > 0) {
        html += '<div style="margin-bottom:12px; text-align:left;"><strong style="color:#888;">ãã®ä»–ã®ãƒ•ã‚©ãƒ¼ãƒ :</strong><br>';
        html += otherForms.map(form => {
          const style = 'display:inline-block; min-width:200px; padding:8px 12px; margin:4px; background:var(--table-background-color); border:2px solid var(--table-border-color); border-radius:8px; cursor:pointer; color:var(--text-color); transition: all 0.2s; text-align:center; vertical-align:top;';
          const hoverStyle = 'onmouseover="this.style.borderColor=\'var(--national-dex-number-color)\'; this.style.transform=\'translateY(-2px)\'" onmouseout="this.style.borderColor=\'var(--table-border-color)\'; this.style.transform=\'translateY(0)\'"';
          const onclick = `onclick="document.getElementById('pokemonName').value=''; document.getElementById('pokemonId').value='${form.id}'; fetchPokemonDetails('${form.id}');"`;
          
          // â˜…â˜…â˜… ä¿®æ­£: displayIdãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ â˜…â˜…â˜…
          let idDisplay;
          if (form.displayId) {
              idDisplay = form.displayId.padStart(4, '0');
          } else if (isNaN(form.id)) {
              idDisplay = 'Form';
          } else {
              idDisplay = form.id.padStart(4, '0');
          }

          return `<span style="${style}" ${onclick} ${hoverStyle}>${form.name}<br><small style="color:#888;">No.${idDisplay}</small></span>`;
        }).join(' ');
        html += '</div>';
      }
      
      return html;
    };
    
    const varietiesHtml = renderVarieties(evolutionChain.varieties);
    if (varietiesHtml) {
      evolutionHtml += `<div style="padding:10px;"><h3>åˆ¥ãƒ•ã‚©ãƒ¼ãƒ  (ã‚¯ãƒªãƒƒã‚¯ã§åˆ‡ã‚Šæ›¿ãˆ)</h3>${varietiesHtml}</div>`;
    }
  }
  
  // é€²åŒ–æƒ…å ±ãŒãªã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  if (!evolutionHtml.includes('é€²åŒ–ç³»çµ±') && !evolutionHtml.includes('åˆ¥ãƒ•ã‚©ãƒ¼ãƒ ')) {
    evolutionHtml = '<div style="padding:20px; text-align:center; color:#888;">é€²åŒ–æƒ…å ±ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
  }
  
  document.getElementById('pokemonEvolution').innerHTML = evolutionHtml;

  // --- å›³é‘‘æƒ…å ±ã‚¿ãƒ– ---
  const dexTableBody = document.createElement('tbody');
  speciesData.pokedex_numbers.forEach(entry => {
    const row = document.createElement('tr');
    const pokedexName = pokedexNameTranslations[entry.pokedex.name] || entry.pokedex.name;
    const formattedNumber = entry.pokedex.name === "national" ? entry.entry_number.toString().padStart(4, '0') : entry.entry_number.toString().padStart(3, '0');
    const url = entry.pokedex.name === "national" ? `https://zukan.pokemon.co.jp/detail/${entry.entry_number}` : '#';
    const td1 = document.createElement('td');
    td1.textContent = pokedexName;
    const td2 = document.createElement('td');
    td2.className = 'pokemon-dex-number';
    if (entry.pokedex.name === "national") {
      td2.innerHTML = `<a href="${url}" target="_blank">${formattedNumber}</a>`;
    } else {
      td2.textContent = formattedNumber;
    }
    row.appendChild(td1);
    row.appendChild(td2);
    dexTableBody.appendChild(row);
  });
  document.getElementById('pokemonDexInfo').innerHTML = '';
  document.getElementById('pokemonDexInfo').appendChild(dexTableBody);
};

const createStatsRadarChart = (stats) => {
  const statNames = {
    'hp': 'HP', 'attack': 'æ”»æ’ƒ', 'defense': 'é˜²å¾¡', 'special-attack': 'ç‰¹æ”»', 'special-defense': 'ç‰¹é˜²', 'speed': 'ç´ æ—©ã•'
  };
  
  const statsData = stats.map(stat => ({
    name: statNames[stat.stat.name] || stat.stat.name,
    value: stat.base_stat
  }));
  
  const total = statsData.reduce((sum, stat) => sum + stat.value, 0);
  
  const container = document.getElementById('pokemonStats');
  container.innerHTML = `
    <div style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
      <div style="text-align: center;">
        <h3 style="margin: 0 0 10px 0; font-size: 1.5rem;">ç¨®æ—å€¤åˆè¨ˆ: <span style="color: var(--national-dex-number-color); font-weight: bold;">${total}</span></h3>
      </div>
      <svg id="radarChart" width="400" height="400" viewBox="0 0 400 400" style="max-width: 100%;">
      </svg>
      <div id="statsTable" style="width: 100%; max-width: 400px;"></div>
    </div>
  `;
  
  const svg = document.getElementById('radarChart');
  const centerX = 200;
  const centerY = 200;
  const maxRadius = 150;
  const maxValue = 255;
  const levels = 5;
  
  // èƒŒæ™¯ã®åŒå¿ƒå††ã‚’æç”»
  for (let i = levels; i > 0; i--) {
    const radius = (maxRadius / levels) * i;
    const opacity = 0.1 + (i / levels) * 0.1;
    drawPolygon(svg, centerX, centerY, radius, 6, `rgba(74, 144, 226, ${opacity})`, 'none', 1);
  }
  
  // è»¸ã‚’æç”»
  const angleStep = (Math.PI * 2) / 6;
  statsData.forEach((stat, index) => {
    const angle = angleStep * index - Math.PI / 2;
    const x = centerX + Math.cos(angle) * maxRadius;
    const y = centerY + Math.sin(angle) * maxRadius;
    
    // è»¸ç·š
    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    line.setAttribute('x1', centerX);
    line.setAttribute('y1', centerY);
    line.setAttribute('x2', x);
    line.setAttribute('y2', y);
    line.setAttribute('stroke', 'rgba(74, 144, 226, 0.3)');
    line.setAttribute('stroke-width', '1');
    svg.appendChild(line);
    
    // ãƒ©ãƒ™ãƒ«
    const labelDistance = maxRadius + 30;
    const labelX = centerX + Math.cos(angle) * labelDistance;
    const labelY = centerY + Math.sin(angle) * labelDistance;
    
    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    text.setAttribute('x', labelX);
    text.setAttribute('y', labelY);
    text.setAttribute('text-anchor', 'middle');
    text.setAttribute('dominant-baseline', 'middle');
    text.setAttribute('fill', 'var(--text-color)');
    text.setAttribute('font-size', '14');
    text.setAttribute('font-weight', '600');
    text.textContent = stat.name;
    svg.appendChild(text);
    
    // å€¤
    const valueY = labelY + 18;
    const valueText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    valueText.setAttribute('x', labelX);
    valueText.setAttribute('y', valueY);
    valueText.setAttribute('text-anchor', 'middle');
    valueText.setAttribute('fill', 'var(--national-dex-number-color)');
    valueText.setAttribute('font-size', '16');
    valueText.setAttribute('font-weight', 'bold');
    valueText.textContent = stat.value;
    svg.appendChild(valueText);
  });
  
  // ãƒ‡ãƒ¼ã‚¿ãƒãƒªã‚´ãƒ³ã‚’æç”»
  const points = statsData.map((stat, index) => {
    const angle = angleStep * index - Math.PI / 2;
    const radius = (stat.value / maxValue) * maxRadius;
    const x = centerX + Math.cos(angle) * radius;
    const y = centerY + Math.sin(angle) * radius;
    return `${x},${y}`;
  }).join(' ');
  
  const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
  polygon.setAttribute('points', points);
  polygon.setAttribute('fill', 'rgba(74, 144, 226, 0.3)');
  polygon.setAttribute('stroke', 'rgb(74, 144, 226)');
  polygon.setAttribute('stroke-width', '2');
  svg.appendChild(polygon);
  
  // ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã‚’æç”»
  statsData.forEach((stat, index) => {
    const angle = angleStep * index - Math.PI / 2;
    const radius = (stat.value / maxValue) * maxRadius;
    const x = centerX + Math.cos(angle) * radius;
    const y = centerY + Math.sin(angle) * radius;
    
    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    circle.setAttribute('cx', x);
    circle.setAttribute('cy', y);
    circle.setAttribute('r', '5');
    circle.setAttribute('fill', 'rgb(74, 144, 226)');
    circle.setAttribute('stroke', 'white');
    circle.setAttribute('stroke-width', '2');
    svg.appendChild(circle);
  });
  
  // çµ±è¨ˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
  const tableHTML =`
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr style="background-color: var(--table-background-color);">
          <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--table-border-color);">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
          <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--table-border-color);">ç¨®æ—å€¤</th>
          <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--table-border-color);">ã‚²ãƒ¼ã‚¸</th>
        </tr>
      </thead>
      <tbody>
        ${statsData.map(stat => {
          const percentage = (stat.value / maxValue) * 100;
          const barColor = stat.value >= 150 ? '#ff6b6b' : stat.value >= 100 ? '#4a90e2' : '#888';
          return `
            <tr style="border-bottom: 1px solid var(--table-border-color);">
              <td style="padding: 12px; font-weight: 600;">${stat.name}</td>
              <td style="padding: 12px; text-align: center; font-weight: bold; color: var(--national-dex-number-color);">${stat.value}</td>
              <td style="padding: 12px;">
                <div style="background: var(--table-background-color); border-radius: 4px; overflow: hidden; height: 20px;">
                  <div style="background: ${barColor}; width: ${percentage}%; height: 100%; transition: width 0.3s;"></div>
                </div>
              </td>
            </tr>
          `;
        }).join('')}
        <tr style="background-color: var(--table-background-color); font-weight: bold;">
          <td style="padding: 12px;">åˆè¨ˆ</td>
          <td style="padding: 12px; text-align: center; color: var(--national-dex-number-color); font-size: 1.1rem;">${total}</td>
          <td style="padding: 12px;"></td>
        </tr>
      </tbody>
    </table>
  `;
  
  document.getElementById('statsTable').innerHTML = tableHTML;
};

const drawPolygon = (svg, centerX, centerY, radius, sides, fill, stroke, strokeWidth) => {
  const points = [];
  const angleStep = (Math.PI * 2) / sides;
  
  for (let i = 0; i < sides; i++) {
    const angle = angleStep * i - Math.PI / 2;
    const x = centerX + Math.cos(angle) * radius;
    const y = centerY + Math.sin(angle) * radius;
    points.push(`${x},${y}`);
  }
  
  const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
  polygon.setAttribute('points', points.join(' '));
  polygon.setAttribute('fill', fill);
  polygon.setAttribute('stroke', stroke);
  polygon.setAttribute('stroke-width', strokeWidth);
  svg.appendChild(polygon);
};
</script>
</body>
</html>
